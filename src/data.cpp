#include "data.h"
#include "color_palette.h"

#if defined (ARDUINO) || defined (__AVR_ATmega328P__)
    #define GET_TILE_ROW(tileIndex, rowIndex) return Data::tile_row_t { .packed = pgm_read_dword_near(&tiles[tileIndex][rowIndex]) }
#else
    #define GET_TILE_ROW(tileIndex, rowIndex) return tiles[tileIndex][rowIndex]
#endif

const uint16_t Data::colors[16] = {
    COLOR_BROWN_DARKER , COLOR_GREEN_LIGHT   , COLOR_MUSTARD    , COLOR_YELLOW,
    COLOR_WHITISH      , COLOR_BLUE_DARK     , COLOR_ORANGE     , COLOR_BEIGE,
    COLOR_BEIGE_DARK   , COLOR_GREEN_DARK    , COLOR_BROWN_DARK , COLOR_BROWN,
    COLOR_BROWN_LIGHT  , COLOR_BROWN_LIGHTER , COLOR_CYAN       , COLOR_RED
};

//define a list of 8x8 tiles of colors from the above array -> a tile will have a size of 32 bytes -> maybe 64 would be enough -> 2048 bytes
const Data::tile_t Data::tiles[] PROGMEM = {
    {//walk1
        { 0, 0, 4, 4, 4, 4, 0, 0},
        { 0, 4, 8, 8, 8, 8, 4, 0},
        { 0, 4, 7, 7, 0,15, 4, 0},
        { 0, 0, 7, 7, 7,15, 0, 0},
        { 0, 0, 1, 1, 1, 0, 0, 0},
        { 0, 0, 2, 2, 2, 0, 0, 0},
        { 0, 8, 2, 2, 2, 0, 0, 0},
        { 0, 0, 8, 8, 0, 0, 0, 0},
    },
    {//walk2
        { 0, 0, 4, 4, 4, 4, 4, 0},
        { 0, 4, 8, 8, 8, 8, 0, 4},
        { 0, 4, 7, 7, 0,15, 0, 0},
        { 0, 0, 7, 7, 7,15, 0, 0},
        { 0, 0, 1, 1, 1, 0, 0, 0},
        { 0, 0, 2, 2, 2, 7, 0, 0},
        { 0, 0, 2, 2, 2, 7, 0, 0},
        { 0, 0, 7, 7, 0, 0, 0, 0},
    },
    {//walk3
        { 0, 0, 0, 0, 0, 0, 0, 0},
        { 0, 0, 4, 4, 4, 4, 4, 4},
        { 0, 4, 8, 8, 8, 8, 0, 0},
        { 0, 4, 7, 7, 0,15, 0, 0},
        { 0, 4, 7, 7, 7,15, 0, 0},
        { 0, 0, 1, 1, 1, 0, 0, 0},
        { 0, 2, 2, 2, 2, 2, 0, 0},
        { 7, 7, 0, 0, 0, 0, 7, 7},
    },
    {//walk4
        { 0, 0, 0, 0, 0, 0, 0, 0},
        { 0, 0, 4, 4, 4, 4, 4, 0},
        { 0, 4, 8, 8, 8, 8, 0, 4},
        { 0, 4, 7, 7, 0,15, 0, 0},
        { 0, 4, 7, 7, 7,15, 0, 0},
        { 0, 0, 1, 1, 1, 0, 0, 0},
        { 7, 2, 2, 2, 2, 0, 0, 0},
        { 7, 0, 0, 7, 7, 0, 0, 0},
    },
    {//idle1
        { 0, 0, 4, 4, 4, 4, 4, 0},
        { 0, 4, 8, 8, 8, 8, 0, 4},
        { 0, 4, 7, 7, 0,15, 0, 0},
        { 0, 0, 7, 7, 7,15, 0, 0},
        { 0, 0, 1, 1, 1, 0, 0, 0},
        { 0, 0, 2, 2, 2, 0, 0, 0},
        { 0, 0, 2, 2, 2, 0, 0, 0},
        { 0, 7, 7, 0, 7, 7, 0, 0},
    },
    {//idle2
        { 0, 0, 0, 0, 0, 0, 0, 0},
        { 0, 0, 4, 4, 4, 4, 4, 4},
        { 0, 4, 8, 8, 8, 8, 0, 0},
        { 0, 4, 7, 7, 0,15, 0, 0},
        { 0, 0, 7, 7, 7,15, 0, 0},
        { 0, 0, 1, 1, 1, 0, 0, 0},
        { 0, 2, 2, 2, 2, 2, 0, 0},
        { 0, 7, 7, 0, 7, 7, 0, 0},
    },
    {//idle3
        { 0, 0, 0, 0, 0, 0, 0, 0},
        { 0, 0, 4, 4, 4, 4, 4, 0},
        { 0, 4, 8, 8, 8, 8, 0, 4},
        { 0, 4, 7, 7, 0,15, 0, 0},
        { 0, 0, 7, 7, 7,15, 0, 0},
        { 0, 0, 1, 1, 1, 0, 0, 0},
        { 0, 2, 2, 2, 2, 2, 0, 0},
        { 0, 7, 7, 0, 7, 7, 0, 0},
    },
    {//idle4
        { 0, 0, 4, 4, 4, 4, 0, 0},
        { 0, 4, 8, 8, 8, 8, 4, 0},
        { 0, 4, 7, 7, 0,15, 4, 0},
        { 0, 0, 7, 7, 7,15, 0, 0},
        { 0, 0, 1, 1, 1, 0, 0, 0},
        { 0, 0, 2, 2, 2, 0, 0, 0},
        { 0, 0, 2, 2, 2, 0, 0, 0},
        { 0, 7, 7, 0, 7, 7, 0, 0},
    },
    {//fall1
        { 0, 0, 0, 0, 0, 0, 0, 4},
        { 0, 0, 4, 4, 4, 4, 4, 0},
        { 0, 4, 8, 8, 8, 8, 0, 0},
        { 0, 4, 7, 7, 0,15, 0, 0},
        { 0, 0, 7, 7, 7,15, 0, 0},
        { 0, 0, 1, 1, 1, 0, 0, 0},
        { 7, 0, 2, 2, 2, 0, 7, 0},
        { 0, 7, 2, 2, 2, 7, 0, 0},
    },
    {//fall2
        { 0, 0, 0, 0, 0, 0, 0, 0},
        { 0, 0, 4, 4, 4, 4, 4, 4},
        { 0, 4, 8, 8, 8, 8, 0, 0},
        { 0, 4, 7, 7, 0,15, 0, 0},
        { 0, 0, 7, 7, 7,15, 0, 0},
        { 0, 0, 1, 1, 1, 0, 0, 0},
        { 7, 0, 2, 2, 2, 0, 7, 0},
        { 0, 7, 2, 2, 2, 7, 0, 0},
    },
    {//jump1
        { 0, 0, 4, 4, 4, 4, 0, 0},
        { 0, 4, 8, 8, 8, 8, 4, 0},
        { 0, 4, 7, 7, 0,15, 4, 0},
        { 0, 0, 7, 7, 7,15, 0, 0},
        { 0, 0, 1, 1, 1, 0, 0, 0},
        { 0, 0, 2, 2, 2, 0, 0, 0},
        { 0, 0, 7, 0, 7, 0, 0, 0},
        { 0, 0, 7, 0, 7, 0, 0, 0},
    },
    {//jump2
        { 0, 0, 4, 4, 4, 4, 0, 0},
        { 0, 4, 8, 8, 8, 8, 4, 0},
        { 0, 4, 7, 7, 0,15, 0, 4},
        { 0, 0, 7, 7, 7,15, 0, 0},
        { 0, 0, 1, 1, 1, 0, 0, 0},
        { 0, 0, 2, 2, 2, 0, 0, 0},
        { 0, 0, 7, 0, 7, 0, 0, 0},
        { 0, 0, 7, 0, 7, 0, 0, 0},
    },
    {//climb1
        { 0, 0, 4, 4, 4, 0, 0, 0},
        { 0, 4, 4, 4, 4, 4, 0, 0},
        { 0, 4, 4, 4, 4, 4, 0, 0},
        { 0, 4, 4, 4, 4, 4, 0, 0},
        { 0, 0, 1, 1, 1, 0, 0, 0},
        { 0, 0, 2, 2, 2, 2, 0, 0},
        { 0, 2, 2, 0, 7, 7, 0, 0},
        { 0, 7, 7, 0, 0, 0, 0, 0},
    },
    {//climb2
        { 0, 0, 0, 4, 4, 4, 0, 0},
        { 0, 0, 4, 4, 4, 4, 4, 0},
        { 0, 0, 4, 4, 4, 4, 4, 0},
        { 0, 0, 4, 4, 4, 4, 4, 0},
        { 0, 0, 0, 1, 1, 1, 0, 0},
        { 0, 0, 2, 2, 2, 2, 0, 0},
        { 0, 0, 7, 7, 0, 2, 2, 0},
        { 0, 0, 0, 0, 0, 7, 7, 0},
    },
    {//coin1                                                                                        14
        { 0, 0, 0, 0, 0, 0, 0, 0},
        { 0, 0, 0, 3, 6, 0, 0, 0},
        { 0, 0, 3, 7, 7, 6, 0, 0},
        { 0, 0, 3, 7, 7, 6, 0, 0},
        { 0, 0, 3, 7, 7, 6, 0, 0},
        { 0, 0, 0, 3, 6, 0, 0, 0},
        { 0, 0, 0, 0, 0, 0, 0, 0},
        { 0, 0, 0, 0, 0, 0, 0, 0},
    },
    {//coin2
        { 0, 0, 0, 0, 0, 0, 0, 0},
        { 0, 0, 0, 3, 6, 0, 0, 0},
        { 0, 0, 0, 3, 6, 0, 0, 0},
        { 0, 0, 0, 3, 6, 0, 0, 0},
        { 0, 0, 0, 3, 6, 0, 0, 0},
        { 0, 0, 0, 3, 6, 0, 0, 0},
        { 0, 0, 0, 0, 0, 0, 0, 0},
        { 0, 0, 0, 0, 0, 0, 0, 0},
    },
    {//coin3
        { 0, 0, 0, 0, 0, 0, 0, 0},
        { 0, 0, 0, 6, 3, 0, 0, 0},
        { 0, 0, 0, 6, 3, 0, 0, 0},
        { 0, 0, 0, 6, 3, 0, 0, 0},
        { 0, 0, 0, 6, 3, 0, 0, 0},
        { 0, 0, 0, 6, 3, 0, 0, 0},
        { 0, 0, 0, 0, 0, 0, 0, 0},
        { 0, 0, 0, 0, 0, 0, 0, 0},
    },
    {//coin4
        { 0, 0, 0, 0, 0, 0, 0, 0},
        { 0, 0, 0, 6, 3, 0, 0, 0},
        { 0, 0, 6, 7, 7, 3, 0, 0},
        { 0, 0, 6, 7, 7, 3, 0, 0},
        { 0, 0, 6, 7, 7, 3, 0, 0},
        { 0, 0, 0, 6, 3, 0, 0, 0},
        { 0, 0, 0, 0, 0, 0, 0, 0},
        { 0, 0, 0, 0, 0, 0, 0, 0},
    },
    {//platform1_1                                                                                  18
        {13,13,11,13,13,11,13,13},
        {13,13,12,12,13,12,13,12},
        {12,12,12,12,11,11,12,11},
        {12,11,11,10,11,11,10,11},
        {11,11,10,10,10,10,10,10},
        {11,11,11,10,10, 0,11, 0},
        {12,11,11, 0, 0, 0, 0, 0},
        {12,10,10, 0, 0,10,10, 0},
    },
    {//platform1_2
        {11,13,13,11,13,13,13,11},
        {12,13,12,12,12,13,13,12},
        {11,12,11,11,11,12,11,11},
        {11,10,12,11,11,10,11,10},
        {10,10,10,10,10,10,10,10},
        { 0,10,10, 0, 0, 0, 0, 0},
        { 0, 0, 0, 0,10,10, 0, 0},
        { 0,11, 0, 0, 0, 0, 0, 0},
    },
    {//platform1_3
        {13,13,11,13,13,11,13,13},
        {13,12,12,13,13,12,12,13},
        {12,11,11,12,11,11,12,12},
        {10,11,11,10,11,11,11,12},
        {10,10,10,10,10,10,11,12},
        { 0,10,10, 0, 0,11,11,11},
        { 0, 0, 0, 0, 0,11,11,11},
        {11, 0,10,10, 0,10,10,12},
    },
    {//platform1_4
        {11,11,11, 0, 0, 0, 0, 0},
        {11,11,10, 0,10,10, 0, 0},
        {12,11,11, 0,10, 0, 0, 0},
        {12,10,10, 0, 0, 0, 0, 0},
        {12,11,10, 0, 0, 0, 0,10},
        {11,11,10, 0,10,11, 0, 0},
        {12,11,11, 0,10,10, 0, 0},
        {12,10,10, 0, 0, 0, 0, 0},
    },
    {//platform1_5
        { 0, 0, 0, 0,11, 0, 0, 0},
        { 0,10,10, 0, 0, 0, 0, 0},
        { 0, 0, 0, 0, 0, 0, 0, 0},
        { 0, 0, 0, 0, 0,10,10, 0},
        { 0, 0, 0, 0, 0, 0, 0, 0},
        {11, 0, 0, 0, 0, 0,11, 0},
        { 0, 0,10,10, 0, 0, 0, 0},
        { 0, 0, 0, 0, 0, 0, 0, 0},
    },
    {//platform1_6
        { 0, 0, 0, 0, 0,11,11,12},
        { 0, 0, 0, 0, 0,10,11,11},
        { 0,10,10, 0, 0,11,11,11},
        { 0, 0, 0, 0,11,10,10,12},
        { 0, 0, 0, 0, 0,10,11,12},
        { 0, 0,10,10, 0,10,11,11},
        { 0, 0,10,10, 0,11,11,12},
        { 0, 0, 0, 0, 0,10,10,12},
    },
    {//stalactite                                                                                     24
        { 0,10,10,10,10,11,10, 0},
        { 0, 0,10,11, 0,11, 0, 0},
        { 0, 0, 0,11, 0,11, 0, 0},
        { 0, 0, 0,11, 0,10, 0, 0},
        { 0, 0, 0,10, 0, 0, 0, 0},
        { 0, 0, 0, 0, 0, 0, 0, 0},
        { 0, 0, 0, 0, 0, 0, 0, 0},
        { 0, 0, 0, 0, 0, 0, 0, 0},
    },
    {//ladder                                                                                         25
        { 0,12,12,12,12,12,12, 0},
        { 0, 0,11, 0, 0,11, 0, 0},
        { 0,12,12,12,12,12,12, 0},
        { 0, 0,11, 0, 0,11, 0, 0},
        { 0,12,12,12,12,12,12, 0},
        { 0, 0,11, 0, 0,11, 0, 0},
        { 0,12,12,12,12,12,12, 0},
        { 0, 0,11, 0, 0,11, 0, 0},
    },
    {//puddle                                                                                         26
        { 1, 1, 1, 1, 1, 1, 1, 1},
        { 9, 9, 9, 9, 9, 9, 9, 9},
        { 1, 9, 9, 9, 9, 9, 9, 9},
        { 9, 9, 9, 9, 9, 9, 9, 9},
        { 9, 9, 9, 9, 9, 9, 9, 9},
        { 9, 9, 9, 9, 9, 9, 9, 9},
        { 9, 9, 9, 9, 9, 1, 9, 9},
        { 9, 9, 9, 9, 9, 9, 9, 9},
    },
    {//pipe                                                                                           27
        { 0, 0, 0, 0, 0, 0, 0, 0},
        { 0, 0,10,10,10,10, 0, 0},
        { 0,10, 0, 0, 0, 0,10, 0},
        { 0,10, 0, 0, 0, 0,10, 0},
        { 0,10, 0, 0, 0, 0,10, 0},
        { 0,10, 1, 1, 1, 1,10, 0},
        {10,10, 1, 9, 1, 1,10,10},
        { 0, 0, 9, 9, 1, 9, 0, 0},
    },
    {//stream                                                                                         28
        { 0, 0, 9, 9, 9, 9, 0, 0},
        { 0, 0, 1, 9, 9, 9, 0, 0},
        { 0, 0, 9, 9, 9, 9, 0, 0},
        { 0, 0, 9, 9, 9, 9, 0, 0},
        { 0, 0, 9, 9, 9, 9, 0, 0},
        { 0, 0, 9, 9, 9, 9, 0, 0},
        { 0, 0, 9, 9, 1, 9, 0, 0},
        { 0, 0, 9, 9, 1, 9, 0, 0},
    },
    {//empty
        { 0, 0, 0, 0, 0, 0, 0, 0},
        { 0, 0, 0, 0, 0, 0, 0, 0},
        { 0, 0, 0, 0, 0, 0, 0, 0},
        { 0, 0, 0, 0, 0, 0, 0, 0},
        { 0, 0, 0, 0, 0, 0, 0, 0},
        { 0, 0, 0, 0, 0, 0, 0, 0},
        { 0, 0, 0, 0, 0, 0, 0, 0},
        { 0, 0, 0, 0, 0, 0, 0, 0},
    }
};

//define a list of meta-tiles of tiles from the list above, if there is a reason to
/*
const metatile_t metatiles[] PROGMEM = {
    {
        {{.index = 1, .flip = 0}},
        {{.index = 2, .flip = 0}},
        {{.index = 3, .flip = 0}},
        {{.index = 0, .flip = 0}},
    }
};
*/

//for the future:
//      - implement a sparse matrix for the level, a lot of entries are just background colored/empty tiles
//      - don't store it in progmem but actually make it loadable from sdcard or if the game is suited make the levels procedural
//      - agree on a level size, 16x20 for now
const Data::tile_index_t Data::level[levelH][levelW] /*PROGMEM*/ =  {
    {{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{18, 0},{25, 0},{19, 0},{19, 0},{19, 0}},
    {{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{21, 0},{25, 0},{22, 0},{22, 0},{22, 0}},
    {{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{21, 0},{25, 0},{22, 0},{22, 0},{22, 0}},
    {{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{19, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{21, 0},{25, 0},{22, 0},{22, 0},{22, 0}},
    {{19, 0},{19, 0},{19, 0},{19, 0},{19, 0},{22, 0},{19, 0},{19, 0},{19, 0},{19, 0},{20, 0},{29, 0},{29, 0},{29, 0},{29, 0},{21, 0},{25, 0},{22, 0},{22, 0},{22, 0}},
    {{22, 0},{22, 0},{22, 0},{22, 0},{22, 0},{22, 0},{22, 0},{22, 0},{22, 0},{22, 0},{23, 0},{29, 0},{29, 0},{29, 0},{29, 0},{21, 0},{25, 0},{22, 0},{22, 0},{22, 0}},
    {{22, 0},{22, 0},{22, 0},{22, 0},{22, 0},{22, 0},{22, 0},{22, 0},{22, 0},{22, 0},{23, 0},{29, 0},{29, 0},{29, 0},{29, 0},{21, 0},{25, 0},{22, 0},{22, 0},{22, 0}},
    {{22, 0},{22, 0},{22, 0},{22, 0},{22, 0},{22, 0},{22, 0},{22, 0},{22, 0},{22, 0},{23, 0},{29, 0},{29, 0},{29, 0},{29, 0},{21, 0},{25, 0},{22, 0},{22, 0},{22, 0}},
    {{24, 0},{24, 0},{24, 0},{24, 0},{24, 0},{24, 0},{24, 0},{24, 0},{24, 0},{24, 0},{24, 0},{29, 0},{29, 0},{29, 0},{29, 0},{21, 0},{25, 0},{22, 0},{22, 0},{22, 0}},
    {{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{25, 0},{22, 0},{22, 0},{22, 0}},
    {{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{25, 0},{22, 0},{22, 0},{22, 0}},
    {{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{18, 0},{19, 0},{19, 0},{22, 0},{22, 0},{22, 0}},
    {{29, 0},{29, 0},{29, 0},{27, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{21, 0},{22, 0},{22, 0},{22, 0},{22, 0},{22, 0}},
    {{29, 0},{29, 0},{29, 0},{28, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{27, 0},{29, 0},{29, 0},{21, 0},{22, 0},{22, 0},{22, 0},{22, 0},{22, 0}},
    {{19, 0},{20, 0},{29, 0},{28, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{29, 0},{28, 0},{29, 0},{29, 0},{21, 0},{22, 0},{22, 0},{22, 0},{22, 0},{22, 0}},
    {{22, 0},{23, 0},{26, 0},{26, 0},{26, 0},{26, 0},{26, 0},{26, 0},{26, 0},{26, 0},{26, 0},{26, 0},{26, 0},{26, 0},{21, 0},{22, 0},{22, 0},{22, 0},{22, 0},{22, 0}},
};


uint8_t Data::getTileByPosition(uint16_t x, uint16_t y) {
    return level[y>>3][x>>3].tile_index.index;
}

uint8_t Data::getTileByIndex(uint8_t i, uint8_t j) {
    return level[i][j].tile_index.index;
}

Data::tile_row_t Data::getTileRow(uint8_t tileIndex, uint8_t rowIndex) {
    GET_TILE_ROW(tileIndex, rowIndex);
}